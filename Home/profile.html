<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/bootstrap.min.css" />
  <link rel="stylesheet" href="css/style.css" />
  <style>.profile-grid{display:flex;gap:24px}.profile-card{flex:1}</style>
</head>
<body>
  <header class="header-section clearfix">
    <a href="index.html" class="site-logo"><img src="Login_SignUp/IMG/final_logo.png" width="160" height="110" alt=""></a>
    <div class="header-right"><div class="user-panel"><a href="Login_SignUp/Login/login.html" class="login">Login</a><a href="Login_SignUp/signup.html" class="register">Create an account</a></div></div>
    <ul class="main-menu"><li><a href="index.html">Home</a></li><li><a href="#">Bookings</a><ul class="sub-menu"><li><a href="my_bookings.html">My Bookings</a></li><li><a href="live_status.html">Live Status</a></li></ul></li><li><a href="profile.html">Profile</a></li></ul>
  </header>

  <main class="container" style="margin-top:30px;">
    <h2>My Profile</h2>
    <div class="profile-grid">
      <div class="profile-card">
        <h4>Account Info</h4>
        <form id="profileForm">
          <div class="form-group"><label>First name</label><input name="firstname" class="form-control"></div>
          <div class="form-group"><label>Last name</label><input name="lastname" class="form-control"></div>
          <div class="form-group"><label>Email</label><input name="email" class="form-control" readonly></div>
          <div class="form-group"><label>Phone</label><input name="phone" class="form-control"></div>
          <div class="form-group"><label>City</label><input name="city" class="form-control"></div>
          <div style="margin-top:12px;"><button id="saveBtn" class="btn btn-primary">Save</button></div>
        </form>
      </div>
      <div class="profile-card">
        <h4>Booking History</h4>
        <div id="history"></div>
      </div>
    </div>
  </main>

  <script src="js/jquery-3.2.1.min.js"></script>
  <script src="Login_SignUp/js/auth-include.js"></script>
  <script src="Login_SignUp/js/auth.js"></script>
  <script>
    (function(){
      var cur = window.EVAuth && window.EVAuth.getCurrentUser ? window.EVAuth.getCurrentUser() : null;
      var form = document.getElementById('profileForm');
      var hist = document.getElementById('history');
      if(!cur){ form.style.display = 'none'; hist.innerHTML = '<p>Please login to see your profile.</p>'; return; }
      // load user data
      var users = window.EVAuth._loadUsers ? window.EVAuth._loadUsers() : [];
      var user = users.find(function(u){ return u.email === cur.email; }) || { email: cur.email, firstname: cur.firstname };
      // populate
      form.firstname.value = user.firstname || '';
      form.lastname.value = user.lastname || '';
      form.email.value = user.email || '';
      form.phone.value = user.phone || '';
      form.city.value = user.city || '';

      function renderHistory(){
        var bookings = window.EVAuth.getBookingsForUser(cur.email) || [];
        if(bookings.length === 0){ hist.innerHTML = '<p>No bookings yet.</p>'; return; }
        var html = '<ul class="list-group">';
        bookings.forEach(function(b){ html += '<li class="list-group-item"><strong>' + (b.time || ('Slot ' + b.seatIndex)) + '</strong> &nbsp; <small>' + b.createdAt + '</small>' + ' <a class="btn btn-sm btn-link" href="booking_details.html?id=' + b.id + '">Details</a>' + '</li>'; });
        html += '</ul>';
        hist.innerHTML = html;
      }
      renderHistory();

      document.getElementById('saveBtn').addEventListener('click', function(e){ e.preventDefault(); var updated = { email: form.email.value, firstname: form.firstname.value, lastname: form.lastname.value, phone: form.phone.value, city: form.city.value }; var res = window.EVAuth.updateUser(updated); if(res && res.ok){ alert('Profile saved'); } else alert((res && res.message) ? res.message : 'Failed to save'); });
    })();
  </script>
</body>
</html>
